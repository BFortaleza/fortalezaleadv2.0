<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SysMaster - Gestión de Créditos</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel para compilar JSX en el navegador -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <style>
        /* Personalización de scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #475569; }
        body { background-color: #080c14; }

        /* Animaciones Personalizadas */
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.2); }
            50% { box-shadow: 0 0 15px rgba(59, 130, 246, 0.6); }
        }

        .animate-slide-in-right { animation: slideInRight 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .animate-fade-in-down { animation: fadeInDown 0.6s ease-out forwards; }
        
        /* Efectos Hover Sutiles */
        .hover-glow:hover {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.15);
            border-color: rgba(59, 130, 246, 0.4);
        }
        
        /* Retrasos para animación en cascada */
        .delay-100 { animation-delay: 100ms; }
        .delay-200 { animation-delay: 200ms; }
        .delay-300 { animation-delay: 300ms; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useRef, useEffect } = React;
        
        // --- DEFINICIÓN MANUAL DE ICONOS ---
        const Icon = ({ children, size = 16, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                {children}
            </svg>
        );

        const LucideIcons = {
            Search: (props) => <Icon {...props}><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></Icon>,
            Filter: (props) => <Icon {...props}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></Icon>,
            ArrowLeft: (props) => <Icon {...props}><path d="m12 19-7-7 7-7"/><path d="M19 12H5"/></Icon>,
            FileText: (props) => <Icon {...props}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></Icon>,
            CheckCircle2: (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></Icon>,
            AlertTriangle: (props) => <Icon {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></Icon>,
            Briefcase: (props) => <Icon {...props}><rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/></Icon>,
            User: (props) => <Icon {...props}><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></Icon>,
            XCircle: (props) => <Icon {...props}><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></Icon>,
            ChevronRight: (props) => <Icon {...props}><path d="m9 18 6-6-6-6"/></Icon>,
            Edit3: (props) => <Icon {...props}><path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/></Icon>,
            Trash2: (props) => <Icon {...props}><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></Icon>,
            X: (props) => <Icon {...props}><path d="M18 6 6 18"/><path d="m6 6 18 18"/></Icon>,
            Building2: (props) => <Icon {...props}><path d="M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z"/><path d="M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2"/><path d="M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2"/><path d="M10 6h4"/><path d="M10 10h4"/><path d="M10 14h4"/><path d="M10 18h4"/></Icon>,
            Phone: (props) => <Icon {...props}><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></Icon>,
            Calendar: (props) => <Icon {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></Icon>,
            Save: (props) => <Icon {...props}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></Icon>,
            Upload: (props) => <Icon {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></Icon>,
        };

        const { 
            Search, Filter, Save, X, Edit3, Briefcase, User, 
            ArrowLeft, XCircle, ChevronRight, Phone, Building2, Trash2, 
            CheckCircle2, AlertTriangle, FileText, Calendar, Upload 
        } = LucideIcons;

        // --- Configuración de Opciones ---
        const OPCIONES = {
            campana: ["REFINANCIAMIENTO CONSUMO", "COMPRA DE DEUDA", "HIPOTECARIO", "PYME", "VEHICULAR", "TARJETA CREDITO"],
            regional: ["COCHABAMBA", "LA PAZ", "SANTA CRUZ", "ORURO", "POTOSI", "TARIJA", "SUCRE", "BENI", "PANDO"],
            oficina: ["AG. 14 DE SEPT EX-PRADO", "AG. EL ALTO", "AG. NORTE", "AG. SUR", "CENTRAL", "AG. 16 DE JULIO", "AG. EQUIPETROL", "AG. CALACOTO"],
            estadoActual: ["CONTACTADO", "NO CONTESTA", "NUMERO EQUIVOCADO", "BUZON DE VOZ", "VISITADO", "PROMESA DE PAGO"],
            comentariosPorEstado: {
                "CONTACTADO": ["INTERESADO EN REFINANCIAMIENTO", "CLIENTE RECHAZA OFERTA", "PIDE LLAMAR LUEGO", "YA PAGO SU CUOTA", "AGENDADA CITA"],
                "NO CONTESTA": ["LLAMAR MAÑANA", "LLAMAR TARDE", "INTENTO 1", "INTENTO 2", "INTENTO 3"],
                "NUMERO EQUIVOCADO": ["ACTUALIZAR TELEFONO", "CLIENTE NO CONOCIDO EN ESTE NUMERO"],
                "BUZON DE VOZ": ["MENSAJE DEJADO", "SIN ESPACIO PARA MENSAJE"],
                "VISITADO": ["CLIENTE NO UBICADO", "DOMICILIO ABANDONADO", "CONTACTO DIRECTO EN DOMICILIO"],
                "PROMESA DE PAGO": ["PAGO EN 24 HORAS", "PAGO EN 48 HORAS", "PAGO FIN DE MES"]
            }
        };

        // Generador de Datos Dummy
        const generateData = () => {
            const baseData = [
                { id: 1, campana: "REFINANCIAMIENTO CONSUMO", regional: "COCHABAMBA", oficina: "AG. 14 DE SEPT EX-PRADO", nroOperacion: "1001273743", nroInterno: "213342", nombreCliente: "LLANOS AIZA MIRKO DENNIS", nombOficial: "CAMACHO ARNEZ FAVIO", fechaUltimoContacto: "2023-10-25", estadoActual: "", comentarios: "", nroDeCre: "", statusDeDatos: "Incompleto" },
                { id: 2, campana: "COMPRA DE DEUDA", regional: "LA PAZ", oficina: "AG. EL ALTO", nroOperacion: "1005582910", nroInterno: "554211", nombreCliente: "QUISPE MAMANI JUAN", nombOficial: "PEREZ LOPEZ MARIA", fechaUltimoContacto: "2023-10-27", estadoActual: "CONTACTADO", comentarios: "INTERESADO EN REFINANCIAMIENTO", nroDeCre: "88921", statusDeDatos: "Completo" },
                { id: 3, campana: "REFINANCIAMIENTO CONSUMO", regional: "SANTA CRUZ", oficina: "AG. NORTE", nroOperacion: "1009928331", nroInterno: "112394", nombreCliente: "VACA DIEZ ROBERTO", nombOficial: "SOUZA CARLOS", fechaUltimoContacto: "2023-10-29", estadoActual: "", comentarios: "", nroDeCre: "", statusDeDatos: "Incompleto" },
                { id: 4, campana: "PYME", regional: "ORURO", oficina: "CENTRAL", nroOperacion: "2001192834", nroInterno: "992134", nombreCliente: "FERRETERIA EL TORNILLO", nombOficial: "GUTIERREZ LUIS", fechaUltimoContacto: "2023-10-28", estadoActual: "NO CONTESTA", comentarios: "INTENTO 1", nroDeCre: "N/A", statusDeDatos: "Completo" },
                { id: 5, campana: "HIPOTECARIO", regional: "LA PAZ", oficina: "AG. SUR", nroOperacion: "3004455123", nroInterno: "776512", nombreCliente: "MENDOZA CLAUDIA", nombOficial: "PEREZ LOPEZ MARIA", fechaUltimoContacto: "2023-10-20", estadoActual: "", comentarios: "", nroDeCre: "", statusDeDatos: "Incompleto" }
            ];

            const extraNames = ["PEREZ JUAN", "LOPEZ ANA", "GARCIA PEDRO", "MAMANI LUCIA", "FLORES CARLOS", "ROJAS MARIA", "VARGAS LUIS", "CRUZ ELENA", "SOTO DAVID", "RUIZ SOFIA", "DIAZ HUGO", "SOSA PAOLA", "LIMA RAUL", "TORO GABY", "VEGA IVAN"];
            
            const extraData = extraNames.map((name, i) => ({
                id: baseData.length + i + 1,
                campana: OPCIONES.campana[i % OPCIONES.campana.length],
                regional: OPCIONES.regional[i % OPCIONES.regional.length],
                oficina: OPCIONES.oficina[i % OPCIONES.oficina.length],
                nroOperacion: `${1000000000 + i * 12345}`,
                nroInterno: `${200000 + i * 321}`,
                nombreCliente: name,
                nombOficial: ["CAMACHO ARNEZ FAVIO", "PEREZ LOPEZ MARIA", "SOUZA CARLOS", "GUTIERREZ LUIS"][i % 4],
                fechaUltimoContacto: i % 3 === 0 ? "2023-10-30" : "",
                estadoActual: i % 3 === 0 ? "NO CONTESTA" : "",
                comentarios: i % 3 === 0 ? "INTENTO 1" : "",
                nroDeCre: "",
                statusDeDatos: i % 3 === 0 ? "Completo" : "Incompleto"
            }));

            return [...baseData, ...extraData];
        };

        const INITIAL_DATA_FULL = generateData();

        // --- Componentes UI ---
        const StatusBadge = ({ status }) => {
            const isComplete = status === "Completo";
            return (
                <span className={`px-2 py-0.5 rounded text-[9px] font-bold uppercase tracking-wider flex items-center justify-center gap-1 w-20 border transition-all duration-300 ${
                isComplete 
                    ? "bg-emerald-500/10 text-emerald-400 border-emerald-500/20 shadow-[0_0_10px_rgba(16,185,129,0.1)]" 
                    : "bg-rose-500/10 text-rose-400 border-rose-500/20 shadow-[0_0_10px_rgba(244,63,94,0.1)]"
                }`}>
                {status}
                </span>
            );
        };

        const SlideToDelete = ({ onDelete }) => {
            const [value, setValue] = useState(0);
            const [confirmed, setConfirmed] = useState(false);

            const handleChange = (e) => {
                const val = parseInt(e.target.value);
                setValue(val);
                if (val === 100) {
                setConfirmed(true);
                setTimeout(() => {
                    onDelete();
                    if (value !== 0) setValue(0); 
                    setConfirmed(false);
                }, 300);
                }
            };

            const handleMouseUp = () => {
                if (value < 100) setValue(0);
            };

            return (
                <div className="relative w-full h-9 bg-red-950/40 rounded border border-red-900/50 overflow-hidden select-none group shadow-inner">
                <div className="absolute inset-0 flex items-center justify-center pointer-events-none z-0">
                    <span className={`text-[9px] font-bold uppercase tracking-widest transition-opacity duration-300 flex items-center gap-1 ${value > 15 ? 'opacity-0' : 'opacity-80 text-red-400'}`}>
                    <Trash2 size={12}/> Deslizar para Borrar
                    </span>
                </div>
                <div className="absolute left-0 top-0 bottom-0 bg-red-600/20 transition-all duration-75 ease-linear z-0" style={{ width: `${value}%` }} />
                <input type="range" min="0" max="100" value={value} onChange={handleChange} onMouseUp={handleMouseUp} onTouchEnd={handleMouseUp} className="absolute inset-0 w-full h-full opacity-0 cursor-ew-resize z-20" />
                <div className="absolute top-0.5 bottom-0.5 w-8 bg-red-600 rounded shadow-[0_0_10px_rgba(220,38,38,0.5)] flex items-center justify-center transition-all duration-75 pointer-events-none z-10" style={{ left: `calc(${value}% - ${value * 0.35}px)` }}>
                    <ChevronRight size={16} className="text-white" />
                </div>
                </div>
            );
        };

        const KpiChip = ({ icon: Icon, label, value, colorClass, borderClass, bgClass, delayClass }) => (
            <div className={`flex items-center gap-3 px-4 py-1.5 rounded-lg border ${borderClass} ${bgClass} hover:bg-opacity-80 transition-all cursor-default group relative overflow-hidden animate-fade-in-down ${delayClass} hover-glow`}>
                <div className={`p-1.5 rounded-md bg-white/5 ${colorClass}`}>
                <Icon size={14} />
                </div>
                <div className="flex flex-col">
                <span className="text-[9px] font-bold text-slate-400 uppercase tracking-wider">{label}</span>
                <span className={`text-sm font-bold ${colorClass} leading-none`}>{value}</span>
                </div>
                <div className={`absolute bottom-0 left-0 h-0.5 w-full ${colorClass.replace('text-', 'bg-')} opacity-0 group-hover:opacity-100 transition-opacity duration-500`}></div>
            </div>
        );

        function useOnClickOutside(ref, handler) {
            useEffect(() => {
                const listener = (event) => {
                if (!ref.current || ref.current.contains(event.target)) {
                    return;
                }
                handler(event);
                };
                document.addEventListener("mousedown", listener);
                document.addEventListener("touchstart", listener);
                return () => {
                document.removeEventListener("mousedown", listener);
                document.removeEventListener("touchstart", listener);
                };
            }, [ref, handler]);
        }

        // --- Componente Principal APP ---
        function App() {
            const [data, setData] = useState(INITIAL_DATA_FULL);
            const [role, setRole] = useState('supervisor');
            
            const [isDrawerOpen, setIsDrawerOpen] = useState(false);
            const [currentRecord, setCurrentRecord] = useState(null);
            
            const [isUploading, setIsUploading] = useState(false);

            const fileInputRef = useRef(null);
            const filterRef = useRef(); 
            
            const [showFilters, setShowFilters] = useState(false);
            const [filterText, setFilterText] = useState('');
            const [filters, setFilters] = useState({
                campana: '', regional: '', oficina: '', nombOficial: '', estadoActual: '', statusDeDatos: '', dateStart: '', dateEnd: ''
            });

            useOnClickOutside(filterRef, () => setShowFilters(false));

            useEffect(() => {
                const handleEsc = (event) => { if (event.key === 'Escape') closeDrawer(); };
                window.addEventListener('keydown', handleEsc);
                return () => window.removeEventListener('keydown', handleEsc);
            }, []);

            const uniqueOficiales = useMemo(() => {
                const oficiales = new Set(data.map(item => item.nombOficial).filter(Boolean));
                return Array.from(oficiales).sort();
            }, [data]);

            const filteredData = useMemo(() => {
                return data.filter(item => {
                const matchesGlobal = filterText === '' || Object.values(item).some(val => String(val).toLowerCase().includes(filterText.toLowerCase()));
                const matchesCampana = filters.campana === '' || item.campana === filters.campana;
                const matchesRegional = filters.regional === '' || item.regional === filters.regional;
                const matchesOficina = filters.oficina === '' || item.oficina === filters.oficina;
                const matchesOficial = filters.nombOficial === '' || item.nombOficial === filters.nombOficial;
                const matchesEstado = filters.estadoActual === '' || item.estadoActual === filters.estadoActual;
                const matchesStatus = filters.statusDeDatos === '' || item.statusDeDatos === filters.statusDeDatos;

                let matchesFecha = true;
                if (filters.dateStart || filters.dateEnd) {
                    if (!item.fechaUltimoContacto) {
                    matchesFecha = false;
                    } else {
                    const itemDate = new Date(item.fechaUltimoContacto);
                    const start = filters.dateStart ? new Date(filters.dateStart) : null;
                    const end = filters.dateEnd ? new Date(filters.dateEnd) : null;
                    if (start && itemDate < start) matchesFecha = false;
                    if (end && itemDate > end) matchesFecha = false;
                    }
                }
                return matchesGlobal && matchesCampana && matchesRegional && matchesOficina && matchesOficial && matchesEstado && matchesStatus && matchesFecha;
                });
            }, [data, filterText, filters]);

            const stats = useMemo(() => {
                const total = filteredData.length;
                const completos = filteredData.filter(i => i.statusDeDatos === "Completo").length;
                const incompletos = total - completos;
                const porcentaje = total > 0 ? Math.round((completos / total) * 100) : 0;
                return { total, completos, incompletos, porcentaje };
            }, [filteredData]);

            const handleFilterChange = (key, value) => setFilters(prev => ({ ...prev, [key]: value }));
            const clearAllFilters = () => {
                setFilters({ campana: '', regional: '', oficina: '', nombOficial: '', estadoActual: '', statusDeDatos: '', dateStart: '', dateEnd: '' });
                setFilterText('');
            };

            const hasActiveFilters = Object.values(filters).some(val => val);

            const openDrawer = (row) => {
                setCurrentRecord({ ...row });
                setIsDrawerOpen(true);
            };

            const closeDrawer = () => {
                setIsDrawerOpen(false);
                setCurrentRecord(null);
            };

            const handleDrawerChange = (field, value) => {
                if (field === 'estadoActual') {
                setCurrentRecord(prev => ({ ...prev, [field]: value, comentarios: '' }));
                } else {
                setCurrentRecord(prev => ({ ...prev, [field]: value }));
                }
            };

            const saveFromDrawer = () => {
                if (!currentRecord) return;
                const requiredFields = ['fechaUltimoContacto', 'estadoActual', 'comentarios'];
                const isComplete = requiredFields.every(field => currentRecord[field] && currentRecord[field].toString().trim() !== "");
                const updatedRow = { ...currentRecord, statusDeDatos: isComplete ? "Completo" : "Incompleto" };
                setData(prev => prev.map(item => item.id === updatedRow.id ? updatedRow : item));
                closeDrawer();
            };

            const handleDelete = () => {
                if (!currentRecord) return;
                setData(prev => prev.filter(item => item.id !== currentRecord.id));
                closeDrawer();
            };

            const handleAddNew = () => {
                const newRow = {
                id: Date.now(),
                campana: OPCIONES.campana[0], regional: OPCIONES.regional[0], oficina: "", nroOperacion: "", nroInterno: "", nombreCliente: "", nombOficial: "",
                fechaUltimoContacto: new Date().toISOString().split('T')[0], estadoActual: "", comentarios: "", nroDeCre: "", statusDeDatos: "Incompleto"
                };
                openDrawer(newRow);
            };
            
            const handleBatchUpload = () => {
                if(fileInputRef.current) fileInputRef.current.click();
            };
            
            const handleFileChange = (e) => {
                if (e.target.files && e.target.files.length > 0) {
                    setIsUploading(true);
                    // Simulamos delay de procesamiento
                    setTimeout(() => {
                        setIsUploading(false);
                        alert("Carga por lotes simulada: 15 registros procesados exitosamente.");
                        e.target.value = null; // reset input
                    }, 1500);
                }
            };

            const handleFilterToggle = () => {
                setShowFilters(prev => !prev);
            };

            const FilterSelect = ({ label, value, onChange, options }) => (
                <div className="flex flex-col gap-1 group">
                <label className="text-[9px] uppercase text-slate-500 font-bold group-hover:text-blue-400 transition-colors">{label}</label>
                <div className="relative">
                    <select value={value} onChange={(e) => onChange(e.target.value)} className="w-full bg-slate-900/50 border border-slate-700 text-[11px] text-slate-200 p-1.5 rounded focus:border-blue-500 focus:bg-slate-900 outline-none appearance-none font-medium transition-colors hover:border-slate-500">
                    <option value="">Todos</option>
                    {options.map(opt => <option key={opt} value={opt}>{opt}</option>)}
                    </select>
                    <div className="absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-slate-500"><ChevronRight size={10} className="rotate-90" /></div>
                </div>
                </div>
            );

            const getComentarioOptions = () => {
                if (!currentRecord) return [];
                const estado = currentRecord.estadoActual;
                return estado ? (OPCIONES.comentariosPorEstado[estado] || []) : [];
            };

            return (
                <div className="min-h-screen bg-[#080c14] text-slate-200 font-sans text-sm selection:bg-blue-500/30 overflow-hidden flex flex-col">
                
                {/* --- HEADER --- */}
                <header className="bg-[#0b1120] border-b border-slate-800 z-30 shrink-0 h-14 flex items-center justify-between px-6 shadow-sm">
                    <div className="flex items-center gap-3">
                        {/* Botón Volver Atrás (Reemplazo del Logo) */}
                        <button 
                            onClick={() => window.history.back()} 
                            className="group flex items-center gap-2 p-1.5 pr-3 rounded-full hover:bg-slate-800/50 transition-all border border-transparent hover:border-slate-700/50"
                            title="Volver atrás"
                        >
                            <div className="bg-slate-800 p-1.5 rounded-full text-slate-400 group-hover:text-blue-400 transition-colors shadow-inner">
                                <ArrowLeft size={16} />
                            </div>
                            <span className="text-[11px] font-bold text-slate-500 uppercase tracking-wider group-hover:text-slate-300 transition-colors">Volver</span>
                        </button>

                        <div className="h-6 w-px bg-slate-800 mx-2"></div>

                        <div>
                            <h1 className="text-sm font-bold text-white tracking-tight leading-none">SYS<span className="text-blue-500">MASTER</span></h1>
                            <span className="text-[9px] text-slate-500 uppercase tracking-widest font-semibold">Enterprise V3.5</span>
                        </div>
                    </div>

                    {/* Micro-Dashboard KPI (Con Animación) */}
                    <div className="hidden md:flex items-center gap-3">
                        <KpiChip icon={FileText} label="Total" value={stats.total} colorClass="text-slate-200" bgClass="bg-slate-800/50" borderClass="border-slate-700" delayClass="delay-100" />
                        <KpiChip icon={CheckCircle2} label="Completos" value={stats.completos} colorClass="text-emerald-400" bgClass="bg-emerald-950/20" borderClass="border-emerald-500/30" delayClass="delay-200" />
                        <KpiChip icon={AlertTriangle} label="Pendientes" value={stats.incompletos} colorClass="text-red-400" bgClass="bg-red-950/20" borderClass="border-red-500/30" delayClass="delay-300" />
                        
                        <div className="flex items-center gap-2 px-3 animate-fade-in-down delay-300">
                            <span className="text-[9px] text-slate-500 font-bold uppercase">Progreso</span>
                            <div className="w-24 h-1.5 bg-slate-800 rounded-full overflow-hidden shadow-inner group relative hover:shadow-[0_0_8px_rgba(59,130,246,0.3)] transition-shadow">
                                <div className="h-full bg-gradient-to-r from-blue-600 via-blue-400 to-emerald-400 transition-all duration-1000 ease-out" style={{width: `${stats.porcentaje}%`}}></div>
                            </div>
                            <span className="text-[10px] text-white font-mono">{stats.porcentaje}%</span>
                        </div>
                    </div>

                    <div className="flex items-center gap-3">
                        <div className="flex bg-slate-900/80 p-0.5 rounded-md border border-slate-800 shadow-inner">
                            <button onClick={() => setRole('supervisor')} className={`px-3 py-1 text-[10px] font-bold uppercase rounded transition-all duration-200 flex items-center gap-1.5 ${role === 'supervisor' ? 'bg-blue-600 text-white shadow-md scale-105' : 'text-slate-500 hover:text-slate-300'}`}>
                            <Briefcase size={12} /> Admin
                            </button>
                            <button onClick={() => setRole('normal')} className={`px-3 py-1 text-[10px] font-bold uppercase rounded transition-all duration-200 flex items-center gap-1.5 ${role === 'normal' ? 'bg-emerald-600 text-white shadow-md scale-105' : 'text-slate-500 hover:text-slate-300'}`}>
                            <User size={12} /> Oper
                            </button>
                        </div>
                    </div>
                </header>

                {/* --- MAIN CONTENT --- */}
                <main className="flex-1 overflow-hidden flex flex-col p-4 w-full max-w-[1920px] mx-auto space-y-3 relative">
                    
                    {/* Toolbar Compacta */}
                    <div className="flex justify-between items-center shrink-0 bg-slate-900/50 p-2 rounded-lg border border-slate-800/50 relative z-40 backdrop-blur-sm animate-fade-in-down">
                        <div className="flex items-center gap-2 flex-1">
                            <div className="relative w-64 group">
                                <Search className="absolute left-2.5 top-1/2 -translate-y-1/2 text-slate-600 group-focus-within:text-blue-500 transition-colors" size={14} />
                                <input 
                                    type="text" 
                                    placeholder="Filtrar registros..." 
                                    value={filterText}
                                    onChange={(e) => setFilterText(e.target.value)}
                                    className="w-full bg-[#080c14] border border-slate-700 text-white pl-8 pr-3 py-1.5 rounded-md text-xs focus:outline-none focus:border-blue-500 transition-all placeholder-slate-600 hover-glow"
                                />
                            </div>
                            
                            <button 
                                onClick={handleFilterToggle}
                                className={`flex items-center gap-2 px-3 py-1.5 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all border active:scale-95 hover-glow ${showFilters ? 'bg-blue-600/10 border-blue-500/50 text-blue-400 shadow-[0_0_10px_rgba(59,130,246,0.2)]' : 'bg-transparent border-slate-700 text-slate-400 hover:text-white hover:bg-slate-800'}`}
                            >
                                <Filter size={12} /> Filtros {hasActiveFilters && <div className="h-1.5 w-1.5 rounded-full bg-blue-400 animate-pulse"></div>}
                            </button>

                            {/* Botón de Reset Rápido */}
                            {hasActiveFilters && (
                                <button 
                                    onClick={clearAllFilters} 
                                    className="flex items-center gap-1.5 px-3 py-1.5 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all border border-red-500/20 bg-red-500/5 text-red-400 hover:bg-red-500/20 active:scale-95 animate-in fade-in zoom-in duration-200"
                                >
                                    <XCircle size={12}/> Limpiar
                                </button>
                            )}
                        </div>
                        
                        {role === 'supervisor' && (
                            <div className="flex items-center gap-2">
                                {/* Botón Importar Lote */}
                                <input type="file" ref={fileInputRef} onChange={handleFileChange} className="hidden" accept=".csv,.xlsx,.json" />
                                <button 
                                    onClick={handleBatchUpload}
                                    disabled={isUploading}
                                    className="bg-slate-800 hover:bg-slate-700 text-slate-300 px-3 py-1.5 rounded-md text-[10px] font-bold uppercase tracking-wide transition-all flex items-center gap-2 border border-slate-700 hover:border-slate-500 active:scale-95 hover-glow disabled:opacity-50 disabled:cursor-wait"
                                >
                                    {isUploading ? (
                                        <>
                                            <div className="w-3 h-3 border-2 border-slate-400 border-t-transparent rounded-full animate-spin"></div>
                                            <span>Procesando...</span>
                                        </>
                                    ) : (
                                        <>
                                            <Upload size={12} /> <span>Importar</span>
                                        </>
                                    )}
                                </button>

                                <button onClick={handleAddNew} className="bg-blue-600 hover:bg-blue-500 text-white px-3 py-1.5 rounded-md text-[10px] font-bold uppercase tracking-wide shadow-lg shadow-blue-900/20 transition-all flex items-center gap-1.5 hover:shadow-blue-500/40 active:scale-95 hover-glow">
                                    <span>+</span> Nuevo
                                </button>
                            </div>
                        )}
                    </div>

                    {/* Panel Filtros (Flotante) */}
                    {showFilters && (
                    <div ref={filterRef} className="absolute top-[60px] left-4 z-50 w-[720px] bg-slate-900/95 backdrop-blur-xl border border-slate-700 rounded-lg p-3 shadow-2xl animate-in slide-in-from-top-2 fade-in duration-200">
                        <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
                        <FilterSelect label="Campaña" value={filters.campana} onChange={(v) => handleFilterChange('campana', v)} options={OPCIONES.campana} />
                        <FilterSelect label="Regional" value={filters.regional} onChange={(v) => handleFilterChange('regional', v)} options={OPCIONES.regional} />
                        <FilterSelect label="Oficina" value={filters.oficina} onChange={(v) => handleFilterChange('oficina', v)} options={OPCIONES.oficina} />
                        <FilterSelect label="Oficial" value={filters.nombOficial} onChange={(v) => handleFilterChange('nombOficial', v)} options={uniqueOficiales} />
                        <FilterSelect label="Estado" value={filters.estadoActual} onChange={(v) => handleFilterChange('estadoActual', v)} options={OPCIONES.estadoActual} />
                        <div className="flex gap-2">
                            <div className="flex-1 flex flex-col gap-1">
                                <label className="text-[9px] text-slate-500 font-bold uppercase">Desde</label>
                                <input type="date" value={filters.dateStart} onChange={(e) => handleFilterChange('dateStart', e.target.value)} className="bg-slate-800 border border-slate-700 text-[10px] text-slate-200 p-1 rounded focus:border-blue-500 outline-none w-full hover:border-slate-500 transition-colors" />
                            </div>
                            <div className="flex-1 flex flex-col gap-1">
                                <label className="text-[9px] text-slate-500 font-bold uppercase">Hasta</label>
                                <input type="date" value={filters.dateEnd} onChange={(e) => handleFilterChange('dateEnd', e.target.value)} className="bg-slate-800 border border-slate-700 text-[10px] text-slate-200 p-1 rounded focus:border-blue-500 outline-none w-full hover:border-slate-500 transition-colors" />
                            </div>
                        </div>
                        </div>
                    </div>
                    )}

                    {/* Tabla Principal */}
                    <div className="flex-1 overflow-hidden bg-slate-900 rounded-lg border border-slate-800 relative shadow-2xl animate-fade-in-down delay-200">
                        <div className="absolute inset-0 overflow-auto scrollbar-thin scrollbar-thumb-slate-700 scrollbar-track-transparent">
                            <table className="w-full text-left border-collapse min-w-[1200px]">
                            <thead className="sticky top-0 z-20 bg-[#0b1120] shadow-sm">
                                <tr>
                                <th className="p-2 w-10 text-center text-[9px] font-bold text-slate-500 uppercase sticky left-0 z-30 bg-[#0b1120] border-r border-slate-800">#</th>
                                <th className="p-2 w-56 text-[9px] font-bold text-blue-400 uppercase sticky left-10 z-30 bg-[#0b1120] border-r border-slate-800 shadow-[2px_0_5px_rgba(0,0,0,0.3)]">Cliente</th>
                                
                                <th className="p-2 min-w-[120px] text-[9px] font-bold text-slate-500 uppercase border-r border-slate-800/50">Campaña</th>
                                <th className="p-2 min-w-[90px] text-[9px] font-bold text-slate-500 uppercase border-r border-slate-800/50">Regional</th>
                                <th className="p-2 min-w-[100px] text-[9px] font-bold text-slate-500 uppercase border-r border-slate-800/50">Oficina</th>
                                <th className="p-2 min-w-[90px] text-[9px] font-bold text-slate-500 uppercase border-r border-slate-800/50">Operación</th>
                                <th className="p-2 min-w-[120px] text-[9px] font-bold text-slate-500 uppercase border-r border-slate-800/50">Oficial</th>
                                
                                <th className="p-2 min-w-[90px] text-[9px] font-bold text-emerald-600 uppercase bg-emerald-950/10">Fecha</th>
                                <th className="p-2 min-w-[120px] text-[9px] font-bold text-emerald-600 uppercase bg-emerald-950/10">Estado</th>
                                <th className="p-2 min-w-[180px] text-[9px] font-bold text-emerald-600 uppercase bg-emerald-950/10">Comentarios</th>
                                <th className="p-2 w-24 text-[9px] font-bold text-slate-500 uppercase text-center">Status</th>
                                </tr>
                            </thead>
                            <tbody className="divide-y divide-slate-800/50 cursor-pointer text-xs">
                                {filteredData.map((row) => (
                                <tr 
                                    key={row.id} 
                                    onClick={() => openDrawer(row)}
                                    className="hover:bg-slate-800/50 transition-all duration-150 group relative hover:shadow-[inset_0_0_20px_rgba(59,130,246,0.05)]"
                                >
                                    <td className="p-2 text-center sticky left-0 z-10 bg-slate-900 group-hover:bg-slate-800 transition-colors border-r border-slate-800 text-slate-500">
                                    <Edit3 size={12} className="mx-auto opacity-30 group-hover:opacity-100 group-hover:text-blue-400 transition-opacity" />
                                    </td>
                                    <td className="p-2 font-medium text-slate-200 sticky left-10 z-10 bg-slate-900 group-hover:bg-slate-800 transition-colors border-r border-slate-800 shadow-[2px_0_5px_rgba(0,0,0,0.3)] truncate max-w-[220px]">
                                    {row.nombreCliente}
                                    </td>

                                    <td className="p-2 text-slate-400 truncate max-w-[150px]">{row.campana}</td>
                                    <td className="p-2 text-slate-400">{row.regional}</td>
                                    <td className="p-2 text-slate-400 truncate max-w-[120px]">{row.oficina}</td>
                                    <td className="p-2 text-slate-500 font-mono text-[11px]">{row.nroOperacion}</td>
                                    <td className="p-2 text-slate-400 truncate max-w-[140px]">{row.nombOficial}</td>
                                    
                                    <td className="p-2 text-emerald-400/90 font-mono text-[11px] bg-emerald-950/5">{row.fechaUltimoContacto || '-'}</td>
                                    <td className="p-2 text-emerald-400 font-medium bg-emerald-950/5">
                                        {row.estadoActual ? <span className="text-[11px]">{row.estadoActual}</span> : '-'}
                                    </td>
                                    <td className="p-2 text-slate-400 truncate max-w-[200px] italic bg-emerald-950/5">{row.comentarios || '-'}</td>
                                    <td className="p-2 flex justify-center"><StatusBadge status={row.statusDeDatos} /></td>
                                </tr>
                                ))}
                            </tbody>
                            </table>
                            
                            {filteredData.length === 0 && (
                            <div className="flex flex-col items-center justify-center py-20 text-slate-500">
                                <p className="text-sm">Sin resultados</p>
                            </div>
                            )}
                        </div>
                    </div>
                </main>

                {/* --- DRAWER (MODAL LATERAL GRANDE - CERO SCROLL) --- */}
                {isDrawerOpen && (
                    <div className="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 transition-opacity flex justify-end" onClick={closeDrawer}>
                    {/* Drawer Panel - MAXIMIZADO & AJUSTADO & ANIMADO */}
                    <div 
                        className="h-full w-[98%] max-w-4xl bg-[#0b1120] shadow-2xl border-l border-slate-700 flex flex-col animate-slide-in-right"
                        onClick={(e) => e.stopPropagation()} 
                    >
                        
                        {/* Header Drawer */}
                        <div className="h-14 px-6 border-b border-slate-800 flex justify-between items-center bg-[#0b1120] shrink-0">
                            <div className="flex items-center gap-4">
                            <div className="p-1.5 bg-blue-600 rounded-lg shadow-blue-500/20"><FileText size={18} className="text-white"/></div>
                            <div>
                                <h2 className="text-base font-bold text-white flex items-center gap-3">
                                    {currentRecord?.nombreCliente || 'Nuevo Registro'}
                                </h2>
                                <div className="flex items-center gap-3 text-[10px] text-slate-400 font-mono">
                                    <span className="bg-slate-800 px-1.5 py-0.5 rounded border border-slate-700">ID: {currentRecord?.id}</span> 
                                    <span className="bg-slate-800 px-1.5 py-0.5 rounded border border-slate-700">OP: {currentRecord?.nroOperacion}</span>
                                </div>
                            </div>
                            </div>
                            <div className="flex items-center gap-3">
                            {currentRecord?.statusDeDatos && <StatusBadge status={currentRecord.statusDeDatos} />}
                            <div className="w-px h-6 bg-slate-700 mx-2"></div>
                            <button onClick={closeDrawer} className="p-2 hover:bg-slate-800 rounded-full text-slate-400 hover:text-white transition-colors" title="Cerrar (Esc)">
                                <X size={20} />
                            </button>
                            </div>
                        </div>

                        {/* Body Drawer (Proporciones Ajustadas) */}
                        <div className="flex-1 overflow-hidden p-6 flex flex-col lg:flex-row gap-6 bg-[#080c14]">
                            
                            {/* COLUMNA IZQUIERDA: DATOS OPERATIVOS (Más ancha ahora) */}
                            <div className={`flex-[1.5] flex flex-col gap-4 p-5 rounded-xl border ${role === 'supervisor' ? 'bg-slate-900 border-slate-700' : 'bg-slate-900/50 border-slate-800 opacity-80 pointer-events-none'}`}>
                                <h3 className="text-[10px] font-bold text-blue-400 uppercase tracking-widest flex items-center gap-2 mb-1 border-b border-slate-800 pb-2">
                                <Building2 size={12}/> Ficha Operativa
                                </h3>
                                
                                <div className="grid grid-cols-6 gap-3">
                                <div className="col-span-6">
                                    <label className="text-[9px] text-slate-400 block mb-1 uppercase font-bold">Nombre Completo</label>
                                    <input type="text" value={currentRecord?.nombreCliente} onChange={(e) => handleDrawerChange('nombreCliente', e.target.value)} disabled={role !== 'supervisor'} className="w-full bg-slate-950 border border-slate-700 rounded p-2 text-sm text-white focus:border-blue-500 outline-none font-medium"/>
                                </div>
                                <div className="col-span-3">
                                    <label className="text-[9px] text-slate-400 block mb-1 uppercase font-bold">Campaña</label>
                                    <select value={currentRecord?.campana} onChange={(e) => handleDrawerChange('campana', e.target.value)} disabled={role !== 'supervisor'} className="w-full bg-slate-950 border border-slate-700 rounded p-2 text-xs text-white outline-none">
                                        {OPCIONES.campana.map(o => <option key={o} value={o}>{o}</option>)}
                                    </select>
                                </div>
                                <div className="col-span-3">
                                    <label className="text-[9px] text-slate-400 block mb-1 uppercase font-bold">Nro Operación</label>
                                    <input type="text" value={currentRecord?.nroOperacion} onChange={(e) => handleDrawerChange('nroOperacion', e.target.value)} disabled={role !== 'supervisor'} className="w-full bg-slate-950 border border-slate-700 rounded p-2 text-xs text-white font-mono outline-none"/>
                                </div>
                                <div className="col-span-2">
                                    <label className="text-[9px] text-slate-400 block mb-1 uppercase font-bold">Regional</label>
                                    <select value={currentRecord?.regional} onChange={(e) => handleDrawerChange('regional', e.target.value)} disabled={role !== 'supervisor'} className="w-full bg-slate-950 border border-slate-700 rounded p-2 text-xs text-white outline-none">
                                        {OPCIONES.regional.map(o => <option key={o} value={o}>{o}</option>)}
                                    </select>
                                </div>
                                <div className="col-span-2">
                                    <label className="text-[9px] text-slate-400 block mb-1 uppercase font-bold">Oficina</label>
                                    <select value={currentRecord?.oficina} onChange={(e) => handleDrawerChange('oficina', e.target.value)} disabled={role !== 'supervisor'} className="w-full bg-slate-950 border border-slate-700 rounded p-2 text-xs text-white outline-none">
                                        {OPCIONES.oficina.map(o => <option key={o} value={o}>{o}</option>)}
                                    </select>
                                </div>
                                <div className="col-span-2">
                                    <label className="text-[9px] text-slate-400 block mb-1 uppercase font-bold">Oficial</label>
                                    <input type="text" value={currentRecord?.nombOficial} onChange={(e) => handleDrawerChange('nombOficial', e.target.value)} disabled={role !== 'supervisor'} className="w-full bg-slate-950 border border-slate-700 rounded p-2 text-xs text-white outline-none"/>
                                </div>
                                </div>
                                
                                {role === 'supervisor' && currentRecord?.id && (
                                <div className="mt-auto pt-4 border-t border-slate-800/50">
                                    <div className="bg-red-950/10 border border-red-900/20 rounded-lg p-2">
                                        <SlideToDelete onDelete={handleDelete} />
                                    </div>
                                </div>
                                )}
                            </div>

                            {/* COLUMNA DERECHA: SEGUIMIENTO */}
                            <div className={`flex-1 flex flex-col gap-3 p-5 rounded-xl border relative overflow-hidden shadow-lg ${role === 'normal' ? 'bg-emerald-950/10 border-emerald-500/30' : 'bg-slate-900 border-slate-700'}`}>
                                {role === 'normal' && <div className="absolute top-0 right-0 p-2 bg-emerald-500/20 rounded-bl-xl text-emerald-400"><Edit3 size={14}/></div>}
                                
                                <h3 className="text-[10px] font-bold text-emerald-400 uppercase tracking-widest flex items-center gap-2 mb-1 border-b border-emerald-500/20 pb-2">
                                <Phone size={12}/> Gestión Activa
                                </h3>

                                <div className="space-y-4">
                                <div className="grid grid-cols-2 gap-3">
                                    <div>
                                        <label className="text-[9px] text-emerald-600 block mb-1 font-bold uppercase">Fecha Contacto</label>
                                        <div className="relative">
                                            <Calendar size={14} className="absolute left-2.5 top-1/2 -translate-y-1/2 text-emerald-600"/>
                                            <input 
                                            type="date"
                                            value={currentRecord?.fechaUltimoContacto} 
                                            onChange={(e) => handleDrawerChange('fechaUltimoContacto', e.target.value)}
                                            className="w-full bg-slate-950 border border-slate-700 rounded p-2.5 pl-8 text-sm text-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none"
                                            />
                                        </div>
                                    </div>
                                    <div>
                                        <label className="text-[9px] text-emerald-600 block mb-1 font-bold uppercase">Nro CRE (Opcional)</label>
                                        <input 
                                            type="text" 
                                            value={currentRecord?.nroDeCre} 
                                            onChange={(e) => handleDrawerChange('nroDeCre', e.target.value)}
                                            className="w-full bg-slate-950 border border-slate-700 rounded p-2.5 text-sm text-white focus:border-emerald-500 outline-none font-mono"
                                            placeholder="---"
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="text-[9px] text-emerald-600 block mb-1 font-bold uppercase">Estado Actual</label>
                                    <select 
                                        value={currentRecord?.estadoActual}
                                        onChange={(e) => handleDrawerChange('estadoActual', e.target.value)}
                                        className="w-full bg-slate-950 border border-slate-700 rounded p-2.5 text-sm text-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none"
                                    >
                                        <option value="">Seleccione Estado...</option>
                                        {OPCIONES.estadoActual.map(o => <option key={o} value={o}>{o}</option>)}
                                    </select>
                                </div>

                                <div>
                                    <label className="text-[9px] text-emerald-600 block mb-1 font-bold uppercase">Detalle / Resultado</label>
                                    <div className="relative">
                                        <select 
                                            value={currentRecord?.comentarios}
                                            onChange={(e) => handleDrawerChange('comentarios', e.target.value)}
                                            disabled={!currentRecord?.estadoActual}
                                            className="w-full bg-slate-950 border border-slate-700 rounded p-2.5 text-sm text-white focus:border-emerald-500 focus:ring-1 focus:ring-emerald-500 outline-none disabled:opacity-50 appearance-none"
                                        >
                                            <option value="">{currentRecord?.estadoActual ? "Seleccione resultado..." : "Seleccione estado primero..."}</option>
                                            {getComentarioOptions().map(o => <option key={o} value={o}>{o}</option>)}
                                        </select>
                                        <div className="absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-emerald-600"><ChevronRight size={14} className="rotate-90"/></div>
                                    </div>
                                </div>
                                </div>
                            </div>

                        </div>

                        {/* Footer Drawer */}
                        <div className="h-14 px-6 border-t border-slate-800 bg-[#0b1120] flex justify-between items-center shrink-0">
                            <span className="text-[10px] text-slate-500">Presiona <span className="font-bold text-slate-400">ESC</span> para cancelar</span>
                            <div className="flex gap-3">
                                <button onClick={closeDrawer} className="px-4 py-2 text-xs font-bold text-slate-400 hover:text-white transition-colors bg-slate-800/50 hover:bg-slate-800 rounded-lg hover-glow">
                                Cancelar
                                </button>
                                <button onClick={saveFromDrawer} className="bg-emerald-600 hover:bg-emerald-500 text-white px-6 py-2 rounded-lg text-xs font-bold uppercase tracking-wide shadow-lg shadow-emerald-900/30 flex items-center gap-2 transition-all transform hover:-translate-y-0.5 active:scale-95 hover-glow">
                                <Save size={14}/> Guardar Cambios
                                </button>
                            </div>
                        </div>

                    </div>
                    </div>
                )}

                </div>
            );
        }

        // --- Renderizado en el DOM ---
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
